{
  "version": 3,
  "sources": ["src/app/directives/duration.component.ts"],
  "sourcesContent": ["import { AsyncPipe, NgClass } from '@angular/common';\nimport { ChangeDetectionStrategy, Component, ElementRef, inject, input } from '@angular/core';\nimport { takeUntilDestroyed, toObservable } from '@angular/core/rxjs-interop';\nimport { DurationFn } from '@app/domain/date-time';\nimport { pad2 } from '@app/utils/number';\nimport { secondsToMilliseconds } from 'date-fns';\nimport { combineLatest, interval, map, shareReplay, startWith } from 'rxjs';\n\nenum DimMode {\n  All,\n  First,\n  None,\n}\n\ntype Fragment = {\n  value: string;\n  unit: Unit;\n  dimmed: DimMode;\n};\n\nenum Unit {\n  Hours = 'h',\n  Minutes = 'm',\n  Seconds = 's',\n}\n\nconst EVERY_SECOND_INTERVAL = interval(secondsToMilliseconds(1)).pipe(\n  startWith(0),\n  map(() => Date.now()),\n  shareReplay({ refCount: true, bufferSize: 1 }),\n);\n\n@Component({\n  selector: 'duration',\n  // prettier-ignore\n  template: `@for(fragment of durationFragments | async; track fragment.unit){<span class=\"fragment\" [ngClass]=\"{ dimmed: fragment.dimmed === DimMode.All }\"><span class=\"value\">@if(fragment.dimmed === DimMode.First){<span class=\"dimmed\">{{ fragment.value.at(0) }}</span><span>{{ fragment.value.slice(1) }}</span>}@else{{{ fragment.value }}}</span><span class=\"unit\">{{ fragment.unit }}</span></span>}`,\n  styles: [\n    `\n      :host {\n        display: inline-flex;\n        gap: 0.35em;\n        --unit-font-size: 0.6em;\n      }\n      .unit {\n        font-size: var(--unit-font-size);\n      }\n      .value {\n        display: inline-flex;\n        align-items: baseline;\n      }\n      .dimmed {\n        opacity: 0.35;\n      }\n    `,\n  ],\n  standalone: true,\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  imports: [NgClass, AsyncPipe],\n})\nexport class DurationComponent {\n  private elementRef = inject(ElementRef<HTMLElement>);\n  public readonly value = input.required<DurationFn>();\n  public readonly DimMode = DimMode;\n  private readonly duration$ = combineLatest([toObservable(this.value), EVERY_SECOND_INTERVAL]).pipe(\n    map(([value, now]) => ({\n      hours: ~~(value(now) / 3600000),\n      minutes: ~~((value(now) % 3600000) / 60000),\n      seconds: ~~((value(now) % 60000) / 1000),\n    })),\n    shareReplay({ refCount: true, bufferSize: 1 }),\n    takeUntilDestroyed(),\n  );\n  public readonly durationFragments = this.duration$.pipe(\n    map(({ hours, minutes, seconds }): Fragment[] => {\n      if (hours === 0 && minutes === 0) {\n        return [{ value: seconds.toString(), unit: Unit.Seconds, dimmed: DimMode.None }];\n      }\n      return [\n        { value: hours.toString(), unit: Unit.Hours, dimmed: hours === 0 ? DimMode.All : DimMode.None },\n        {\n          value: pad2(minutes),\n          unit: Unit.Minutes,\n          dimmed: hours === 0 && minutes === 0 ? DimMode.All : minutes < 10 ? DimMode.First : DimMode.None,\n        },\n      ];\n    }),\n    takeUntilDestroyed(),\n  );\n  private textValue$ = this.duration$.pipe(map(({ hours, minutes, seconds }) => `${hours}h ${minutes}m ${seconds}s`));\n  constructor() {\n    this.textValue$.pipe(takeUntilDestroyed()).subscribe((value) => {\n      this.elementRef.nativeElement.setAttribute('aria-label', value);\n      this.elementRef.nativeElement.setAttribute('title', value);\n    });\n  }\n}\n"],
  "mappings": "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",
  "names": ["\u0275\u0275elementStart", "\u0275\u0275text", "\u0275\u0275elementEnd", "\u0275\u0275advance", "\u0275\u0275textInterpolate", "fragment_r1", "value", "at", "slice", "\u0275\u0275template", "DurationComponent_For_1_Conditional_2_Template", "DurationComponent_For_1_Conditional_3_Template", "\u0275\u0275property", "\u0275\u0275pureFunction1", "_c0", "dimmed", "ctx_r1", "DimMode", "All", "\u0275\u0275conditional", "First", "unit", "Unit", "EVERY_SECOND_INTERVAL", "interval", "secondsToMilliseconds", "pipe", "startWith", "map", "Date", "now", "shareReplay", "refCount", "bufferSize", "DurationComponent", "elementRef", "inject", "ElementRef", "input", "required", "duration$", "combineLatest", "toObservable", "hours", "minutes", "seconds", "takeUntilDestroyed", "durationFragments", "toString", "Seconds", "None", "Hours", "pad2", "Minutes", "textValue$", "constructor", "subscribe", "nativeElement", "setAttribute", "selectors", "inputs", "standalone", "features", "\u0275\u0275StandaloneFeature", "decls", "vars", "consts", "template", "rf", "ctx", "\u0275\u0275repeaterCreate", "DurationComponent_For_1_Template", "_forTrack0", "\u0275\u0275repeater", "\u0275\u0275pipeBind1", "NgClass", "AsyncPipe", "styles", "changeDetection"]
}
